<!DOCTYPE html>
<html>
	<head>
		<style>
			#campoJogo{
			    width: 300px;
			    height: 600px;
			    
			    top: 0;
			    bottom: 0;
			    left: 0;
			    right: 0;
			    margin: auto;
			    outline: 1px solid;
			}
			.campo{
			    width: 30px;
			    height: 30px;
			    
			    float: left;
			}
		</style>
	</head>	
	<body>
		<div id='campoJogo'></div>
	</body>
</html>
<script type="text/javascript" >
		
	//(function() {
		var linhas = 20;
		var colunas = 10;
		var direcao = 'd'; //c = cima / b = baixo / d = direita / e = esquerda
		var speed = 400;
		var lin = 0
		var col = 0
		var fim = false;
		var pontos = 0;
		var direcaoTemp = 'd';
		var objeto = null;

		var t = {
			'sentido': 'b',
			'color': 'red',
			'limpar': function() {
				this['a'].removeAttribute("style");
				this['b'].removeAttribute("style");
				this['c'].removeAttribute("style");
				this['d'].removeAttribute("style");
			},
			'girar': function() {
				this['limpar']();
				var a_col, b_col, c_col, d_col = 0
				var s = '';
				var a_col = parseInt(this['a'].getAttribute("data-coluna"));
				var b_col = parseInt(this['b'].getAttribute("data-coluna"));
				var c_col = parseInt(this['c'].getAttribute("data-coluna"));
				var d_col = parseInt(this['d'].getAttribute("data-coluna"));

				var b_lin = parseInt(this['b'].getAttribute("data-linha"));
			
				switch(this['sentido']){
					case 'b':
						b_lin -= 1;
						s = 'e';
						break;
					case 'e':
						b_col += 1;
						s = 'c';
						break;
					case 'c':
						b_lin += 1;
						s = 'd';
						break;
					case 'd':
						b_col -= 1;
						s = 'b';
						break;
				}

				if(b_col < colunas && b_col >= 0){
						this['sentido'] = s;
						this['c'] = this['d']
						this['d'] = this['a']	
						this['a'] = document.querySelector('[data-linha="' + b_lin + '"][data-coluna="' + b_col + '"]');
				}
				this['pintar']();
			},
			'criar': function() {
				this['a'] = document.querySelector('[data-linha="1"][data-coluna="3"]');
				this['b'] = document.querySelector('[data-linha="1"][data-coluna="4"]');
				this['c'] = document.querySelector('[data-linha="1"][data-coluna="5"]');
				this['d'] = document.querySelector('[data-linha="2"][data-coluna="4"]');
				this['pintar']();
			},
			'pintar': function(){
				this['a'].style.backgroundColor = this['color'];
				this['b'].style.backgroundColor = this['color'];
				this['c'].style.backgroundColor = this['color'];
				this['d'].style.backgroundColor = this['color'];
			},
			'mover': function(sentido){
				this['limpar']();
				var a_col = parseInt(this['a'].getAttribute("data-coluna"));
				var b_col = parseInt(this['b'].getAttribute("data-coluna"));
				var c_col = parseInt(this['c'].getAttribute("data-coluna"));
				var d_col = parseInt(this['d'].getAttribute("data-coluna"));
				
				a_col += sentido;
				b_col += sentido;
				c_col += sentido;
				d_col += sentido;
				
				if( Math.min(a_col, b_col, c_col, d_col) >= 0 && Math.max(a_col, b_col, c_col, d_col) < colunas ){
					this['a'] = document.querySelector('[data-linha="' + this['a'].getAttribute("data-linha") + '"][data-coluna="' + a_col + '"]');
					this['b'] = document.querySelector('[data-linha="' + this['b'].getAttribute("data-linha") + '"][data-coluna="' + b_col + '"]');
					this['c'] = document.querySelector('[data-linha="' + this['c'].getAttribute("data-linha") + '"][data-coluna="' + c_col + '"]');
					this['d'] = document.querySelector('[data-linha="' + this['d'].getAttribute("data-linha") + '"][data-coluna="' + d_col + '"]');
				}
				this['pintar']();
			}
		};

		function criarCampo(){
			for (i = 0; i < linhas; i++) { 
				var divLinha = document.createElement('div');
				divLinha.setAttribute('id', 'linha' + i);
				document.getElementById("campoJogo").appendChild(divLinha);
				for (j = 0; j < colunas; j++) { 
					var div = document.createElement('div');
					div.className = 'campo';
					div.setAttribute('data-linha', i);
					div.setAttribute('data-coluna', j);
					document.getElementById("linha"+i).appendChild(div);
				}
			}
		}

		function gerarObjeto(){
			if(objeto == null){
				//sort objeto
				objeto = t;
				objeto.criar();
			}
		}



		function executarJogo(){
			setTimeout(function () {
				gerarObjeto();
				//verificaColisao(set objeto null);
				//removeLinhas(+pontos);
				//descerObjeto();
				//varificaPerdeu();

				if(!fim){
					executarJogo();
				} else {
					setTimeout(function() {
						alert("Voce perdeu !! Sua pontuacao foi de: " + pontos);
					}, 10);
				}

			}, speed)
		}

		document.onkeyup = function (e) {
			var key = (window.event || e).keyCode;
			
			if (key == 32){
				//direcaoTemp = 'e';
				objeto.girar();
			} else if (key == 37 || key == 65) {
				objeto.mover(-1);
			} else if (key == 39 || key == 68) {
				objeto.mover(+1);
			}
		};
		
		criarCampo();
		executarJogo();
//	})();
			
</script>
