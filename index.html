<!DOCTYPE html>
<html>
	<head>
		<style>
			#campoJogo{
			    width: 500px;
			    height: 500px;
			    
			    top: 0;
			    bottom: 0;
			    left: 0;
			    right: 0;
			    margin: auto;
			    outline: 1px solid;
			}

			#header{
				width: 500px;
				top: 0;
			    bottom: 0;
			    left: 0;
			    right: 0;
			    margin: auto;
			    margin-bottom: 30px
			}

			#nomeDoJogo{
				float: left;
			}

			#pontuacao{
				margin-left: 100px;
			}

			.campo{
			    width: 50px;
			    height: 50px;
			    outline: 1px solid;
			    float: left;
			}
		</style>
	</head>	
	<script type="text/javascript" >

		var linhas = 10;
		var colunas = 10;
		var direcao = 'd'; //c = cima / b = baixo / d = direita / e = esquerda
		var snake = [];
		var speed = 700;
		var lin = 0
		var col = 0
		var fim = false;
		var comida = false;
		var comida_ele;
		var pontos = 0;

		function sleep(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}

		function criarCampo(){
			for (i = 0; i < linhas; i++) { 
			    for (j = 0; j < colunas; j++) { 
			    	var div = document.createElement('div');
			    	div.className = 'campo';
			    	div.setAttribute('data-linha', i);
			    	div.setAttribute('data-coluna', j);
			    	document.getElementById("campoJogo").appendChild(div);
			    }
			}
		}

		function pintarSnake(){
			for (var i = 0; i < snake.length; i++) {
				snake[i].style.backgroundColor = 'gray';
			}
			snake[0].style.backgroundColor = 'red';
			snake[snake.length-1].style.backgroundColor = 'blue';
		}

		function criarSnake(){
			snake[0] = document.querySelector('[data-linha="5"][data-coluna="5"]');
			snake[1] = document.querySelector('[data-linha="5"][data-coluna="4"]');
			snake[2] = document.querySelector('[data-linha="5"][data-coluna="3"]');
			pegarProximoCampo();
		}

		function pegarProximoCampo(){
			lin = parseInt(snake[0].getAttribute("data-linha"));
			col = parseInt(snake[0].getAttribute("data-coluna"));

			
			
			if (direcao == 'd'){
				col += 1;
			} else if (direcao == 'e'){
				col -= 1;
			} else if (direcao == 'c'){
				lin -= 1
			} else if (direcao == 'b'){
				lin += 1
			}

			if( lin % linhas == 0){lin = 0}
			if( lin == -1){lin = linhas - 1}
			if( col % colunas == 0){col = 0}
			if( col == -1){col = colunas - 1}
		}

		function moverSnake(){
			snake.unshift(document.querySelector('[data-linha="' + lin + '"][data-coluna="' + col + '"]'));

			verificaComeu();
			if (comida){
				snake[snake.length-1].removeAttribute("style");
				snake.pop();
			}
			gerarComida();
		}

		function verificaColisao(){
			var snk = snake.slice();
			snk.shift();
			var prox_elem = document.querySelector('[data-linha="' + lin + '"][data-coluna="' + col + '"]')
			fim = snk.includes(prox_elem);
		}

		function gerarComida(){
			if(!comida){
				var com_lin = Math.floor((Math.random() * 9));
				var com_col = Math.floor((Math.random() * 9));

				while(snake.includes(document.querySelector('[data-linha="' + com_lin + '"][data-coluna="' + com_col + '"]'))){
					com_lin = Math.floor((Math.random() * 9));
					com_col = Math.floor((Math.random() * 9));
				}
								
				comida_ele = document.querySelector('[data-linha="' + com_lin + '"][data-coluna="' + com_col + '"]');
				comida_ele.style.backgroundColor = 'green';
				
				comida = true;
			}
		}

		function verificaComeu(){
			if(snake[0] == comida_ele){
				pontos += 10;
				comida = false;	
				document.getElementById("pontuacao").innerText = pontos
				if(speed > 300){
					speed -= 30;
				}
			}
		}

		function executarJogo(){
			var jogoLoop = setTimeout(function () {
				pegarProximoCampo();
				moverSnake();
				verificaColisao();
				pintarSnake();
				
				if(!fim){
					executarJogo();
				} else {
					alert("Voce perdeu !! Sua pontuacao foi de: " + pontos)
				}

			}, speed)
		}

		function inicializarJogo(){
			criarCampo();
			criarSnake();
			pintarSnake();
			gerarComida();
			executarJogo();
		};

		document.onkeyup = function (e) {
		    var evento = window.event ? window.event : e;

		    if(evento.keyCode == 37 && direcao != 'd'){
		    	direcao = 'e';
		    } else if (evento.keyCode == 38 && direcao != 'b'){
		    	direcao = 'c';
		    } else if (evento.keyCode == 39 && direcao != 'e'){
		    	direcao = 'd';
		    } else if (evento.keyCode == 40 && direcao != 'c'){
		    	direcao = 'b';
		    }
		};

		window.onload = inicializarJogo;
		
  	</script>
	<body>
		<div id='header'>
			<div id='nomeDoJogo'>SNAKE</div>
			<div id='pontuacao'>0</div>
		</div>
		<div id='campoJogo'>
			
  		</div>

	</body>
</html>