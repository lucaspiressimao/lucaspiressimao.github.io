<!DOCTYPE html>
<html>
	<head>
		<style>
			#campoJogo{
			    width: 750px;
			    height: 750px;
			    
			    top: 0;
			    bottom: 0;
			    left: 0;
			    right: 0;
			    margin: auto;
			    outline: 1px solid;
			}

			#header{
				width: 500px;
				top: 0;
			    bottom: 0;
			    left: 0;
			    right: 0;
			    margin: auto;
			    margin-bottom: 30px
			}

			#nomeDoJogo{
				float: left;
			}

			#pontuacao{
				margin-left: 100px;
			}

			.campo{
			    width: 50px;
			    height: 50px;
			    
			    float: left;
			}
		</style>
	</head>	
	<body>
		<div id='header'>
			<div id='nomeDoJogo'>SNAKE</div>
			<div id='pontuacao'>0</div>
		</div>
		<div id='campoJogo'></div>
	</body>
</html>
<script type="text/javascript" >
		
	(function() {
		var linhas = 15;
		var colunas = 15;
		var direcao = 'd'; //c = cima / b = baixo / d = direita / e = esquerda
		var snake = [];
		var speed = 400;
		var lin = 0
		var col = 0
		var fim = false;
		var comida = false;
		var comida_ele;
		var pontos = 0;
		var click = false;

		function sleep(ms) {
			return new Promise(resolve => setTimeout(resolve, ms));
		}

		function criarCampo(){
			for (i = 0; i < linhas; i++) { 
				for (j = 0; j < colunas; j++) { 
					var div = document.createElement('div');
					div.className = 'campo';
					div.setAttribute('data-linha', i);
					div.setAttribute('data-coluna', j);
					document.getElementById("campoJogo").appendChild(div);
				}
			}
		}

		function pintarSnake(){
			for (var i = 0; i < snake.length; i++) {
				snake[i].style.backgroundColor = 'gray';
			}
			snake[0].style.backgroundColor = 'red';
			snake[snake.length-1].style.backgroundColor = 'blue';
		}

		function criarSnake(){
			snake[0] = document.querySelector('[data-linha="5"][data-coluna="5"]');
			snake[1] = document.querySelector('[data-linha="5"][data-coluna="4"]');
			snake[2] = document.querySelector('[data-linha="5"][data-coluna="3"]');
			pegarProximoCampo();
		}

		function pegarProximoCampo(){
			lin = parseInt(snake[0].getAttribute("data-linha"));
			col = parseInt(snake[0].getAttribute("data-coluna"));

			
			
			if (direcao == 'd'){
				col += 1;
			} else if (direcao == 'e'){
				col -= 1;
			} else if (direcao == 'c'){
				lin -= 1
			} else if (direcao == 'b'){
				lin += 1
			}

			if( lin % linhas == 0){lin = 0}
			if( lin == -1){lin = linhas - 1}
			if( col % colunas == 0){col = 0}
			if( col == -1){col = colunas - 1}
		}

		function moverSnake(){
			snake.unshift(document.querySelector('[data-linha="' + lin + '"][data-coluna="' + col + '"]'));
			click = false;
			
			verificaComeu();
			if (comida){
				snake[snake.length-1].removeAttribute("style");
				snake.pop();
			}
			gerarComida();
		}

		function verificaColisao(){
			var snk = snake.slice();
			snk.shift();
			var prox_elem = document.querySelector('[data-linha="' + lin + '"][data-coluna="' + col + '"]')
			fim = snk.includes(prox_elem);
		}

		function gerarComida(){
			if(!comida){
				var com_lin = Math.floor((Math.random() * 9));
				var com_col = Math.floor((Math.random() * 9));

				while(snake.includes(document.querySelector('[data-linha="' + com_lin + '"][data-coluna="' + com_col + '"]'))){
					com_lin = Math.floor((Math.random() * 9));
					com_col = Math.floor((Math.random() * 9));
				}
								
				comida_ele = document.querySelector('[data-linha="' + com_lin + '"][data-coluna="' + com_col + '"]');
				comida_ele.style.backgroundColor = 'green';
				
				comida = true;
			}
		}

		function verificaComeu(){
			if(snake[0] == comida_ele){
				pontos += 10;
				comida = false;	
				document.getElementById("pontuacao").innerText = pontos
				if(speed > 10){
					speed -= 50;
				}
			}
		}

		function executarJogo(){
			var jogoLoop = setTimeout(function () {
				pegarProximoCampo();
				moverSnake();
				verificaColisao();
				pintarSnake();
				
				if(!fim){
					executarJogo();
				} else {
					alert("Voce perdeu !! Sua pontuacao foi de: " + pontos)
				}

			}, speed)
		}

		document.onkeyup = function (e) {
			var key = (window.event || e).keyCode;

			if(!click){
				if ((key == 37 || key == 65) && direcao != 'd')
					direcao = 'e';
				else if ((key == 38 || key == 87) && direcao != 'b')
					direcao = 'c';
				else if ((key == 39 || key == 68) && direcao != 'e')
					direcao = 'd';
				else if ((key == 40 || key == 83) && direcao != 'c')
					direcao = 'b';
				click = true;
			}
		};
		
		criarCampo();
		criarSnake();
		pintarSnake();
		gerarComida();
		executarJogo();
	})();
			
</script>
